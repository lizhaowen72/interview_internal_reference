#### **题目**：输入 ping IP 后敲回车，发包前会发生什么？

#### **出题人**：阿里巴巴出题专家：怀虎／阿里云云效平台负责人

#### **参考答案**：
ping目标ip时，先查路由表，确定出接口
- 如果落在直连接口子网内，此时若为以太网等 _多路访问网络_ 则先查询arp缓存，命中则直接发出，否则在该接口上发arp询问目标ip的mac地址，取得后发出，若为ppp等 _点对点网络_ ，则直接可以发出；
- 如果查表落在缺省路由上，此时若为以太网等 _多路访问网络_ 则先查询网关arp缓存，命中则直接发出，否则在该接口上发arp询问网关的mac地址，取得后发出，若为ppp等 _点对点网络_ ，则直接可以发出；
- 若查表未命中，则返回不可达。

首先根据目的IP和路由表决定走哪个网卡，再根据网卡的子网掩码地址判断目的IP是否在子网内。
如果不在则会通过arp缓存查询IP的网卡地址，不存在的话会通过广播询问目的IP的mac地址，得到后就开始发包了，同时mac地址也会被arp缓存起来

路由表:在计算机网络中，路由表（routing table）或称路由择域信息库（RIB, Routing Information Base），是一个存储在路由器或者联网计算机
中的电子表格（文件）或类数据库。路由表存储着指向特定网络地址的路径（在有些情况下，还记录有路径的路由度量值）。路由表中含有网络周边的拓扑信息。路由表建立的主要目标是为了实现路由协议和静态路由选择

网卡:网卡是一块被设计用来允许计算机在计算机网络上进行通讯的计算机硬件。由于其拥有MAC地址，因此属于OSI模型的第2层。它使得用户可以通过电缆或无线相互连接。
每一个网卡都有一个被称为MAC地址的独一无二的48位串行号，它被写在卡上的一块ROM中。在网络上的每一个计算机都必须拥有一个独一无二的MAC地址。没有任何两块被生产出来的网卡拥有同样的地址。这是因为电气电子工程师协会（IEEE）负责为网络接口控制器（网卡）销售商分配唯一的MAC地址。

子网掩码:子网掩码(subnet mask)又叫网络掩码、地址掩码、子网络遮罩，它是一种用来指明一个IP地址的哪些位标识的是主机所在的子网，
以及哪些位标识的是主机的位掩码。子网掩码不能单独存在，它必须结合IP地址一起使用。子网掩码只有一个作用，就是将某个IP地址划分
成网络地址和主机地址两部分。
arp缓存:当要访问某个IP，计算机必须知道这个IP的物理地址（MAC地址），这时计算机会发一个广播式的数据包询问：“ipx.x.x.x对应的mac是什么？我是IP y.y.y.y , 我的mac是yy-yy-yy-yy-yy-yy” 整个局域网的机子都收到这个询问，真正拥有这个IP的机子就会回答它：“IP x.x.x.x的mac地址是我这个xx-xx-xx-xx-xx-xx”。
      询问的机子会临时保存这个在“IP－MAC对照表”，一段时间不与某IP通讯的话，会删除对应条目。“IP－MAC对照表”中的临时条目就是arp缓存。
      另，即使不是正确的机器也可以回答那个询问，回答一个错误的MAC，有可能让询问的机子发数据到错误的机子。这就叫“ARP欺骗”，可以说是利用arp协议设计上的漏洞。防止方法是设置静态“IP－MAC对照条目”
mac地址: